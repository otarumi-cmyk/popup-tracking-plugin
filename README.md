# Popup Tracking Plugin

WordPressサイトの記事にモーダル型ポップアップを表示し、**記事ごとのクリック率（CTR）**を計測するプラグインです。

## ✨ 機能一覧

### ポップアップ機能
- ✅ モーダル型ポップアップ表示
- ✅ **画像の追加**（メディアライブラリから選択）
- ✅ 表示タイミング選択
  - ページ読み込み後○秒後
  - スクロール○%到達時
  - 離脱意図検知時（Exit Intent）
- ✅ 表示頻度設定（1日1回/1セッション1回）
- ✅ LINE友だち追加ボタン

### 表示条件設定
- ✅ **記事ごとの表示/非表示設定**
  - すべての記事に表示
  - 特定の記事のみに表示
  - 特定の記事を除外
- ✅ **カテゴリごとの表示/非表示設定**
  - すべてのカテゴリ
  - 特定カテゴリのみ表示
  - 特定カテゴリを除外

### レポート機能
- ✅ **3種類のランキング**
  - CTR（クリック率）ランキング
  - クリック数ランキング
  - 表示数ランキング
- ✅ **デバイス別集計**（PC/SP）
- ✅ **期間フィルター**
  - 今日/今週/今月
  - カスタム期間（日付指定）
- ✅ **CSVエクスポート**

### データ管理
- ✅ 計測ログのリセット機能

---

## 📦 インストール

1. `popup-tracking-plugin` フォルダをWordPressの `/wp-content/plugins/` にアップロード
2. WordPress管理画面 → プラグイン → 「Popup Tracking」を有効化
3. 左メニューに「ポップアップ計測」が追加されます

---

## 🚀 使い方

### 1. ポップアップ設定

1. WordPress管理画面 → ポップアップ計測 → **ポップアップ設定**
2. 以下を設定：
   - タイトル
   - 本文
   - 画像（任意）
   - ボタンテキスト
   - LINE友だち追加URL
   - 表示タイミング
   - 表示頻度
3. 「有効/無効」をONにして保存

### 2. 表示条件設定

1. WordPress管理画面 → ポップアップ計測 → **表示条件設定**
2. 以下を設定：

#### 記事の表示設定
| モード | 説明 |
|--------|------|
| すべての記事に表示 | 全記事でポップアップを表示 |
| 特定の記事のみに表示 | 選択した記事だけに表示 |
| 特定の記事を除外 | 選択した記事以外に表示 |

#### カテゴリ設定
| モード | 説明 |
|--------|------|
| すべてのカテゴリ | カテゴリ関係なく表示 |
| 特定カテゴリのみ表示 | 選択したカテゴリの記事のみ表示 |
| 特定カテゴリを除外 | 選択したカテゴリの記事では非表示 |

### 3. データ確認

- WordPress管理画面 → ポップアップ計測 → **ダッシュボード**
- 期間フィルターで表示期間を切り替え
- 3種類のランキング（CTR/クリック数/表示数）を切り替え可能
- CSVエクスポートでデータをダウンロード

---

## 📁 ファイル構成

```
popup-tracking-plugin/
├── popup-tracking.php          # メインプラグインファイル
├── includes/
│   ├── class-database.php      # DB操作
│   ├── class-admin.php         # 管理画面
│   └── class-frontend.php      # フロント表示
├── assets/
│   ├── js/
│   │   ├── popup.js            # ポップアップJS
│   │   └── admin.js            # 管理画面JS
│   └── css/
│       ├── popup.css           # ポップアップCSS
│       └── admin.css           # 管理画面CSS
└── README.md
```

---

## ⚙️ 動作要件

- WordPress 6.0以上
- PHP 7.4以上

---

## 📊 計測データ

### 記録されるイベント

| イベント | 説明 |
|---------|------|
| impression | ポップアップ表示 |
| click | CTAボタンクリック |
| close | ポップアップを閉じた |

### 計算される指標

- **表示数**: impressionの合計
- **クリック数**: clickの合計
- **閉じた数**: closeの合計
- **CTR（クリック率）**: クリック数 ÷ 表示数 × 100

---

## 🎨 カスタマイズ

### ポップアップのデザイン変更

`assets/css/popup.css` を編集してください。

### 固定ページにも表示

`includes/class-frontend.php` の `is_singular('post')` を `is_singular()` に変更してください。

---

## 📜 ライセンス

MIT
